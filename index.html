<!doctype html>
<html lang="ja">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
        integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <script>

        window.onload = () => {
            initCategory();
            initPrefecture();
            initRegion();
            initShop();
        };

        var initCategory = () => {
            const paramKey = 'category';
            const targetId = 'category-list';
            // instantiate a headers object
            var myHeaders = new Headers();
            // add content type header to object
            myHeaders.append('Content-Type', 'application/json');
            // create a JSON object with parameters for API call and store in a variable
            var requestOptions = {
                method: 'POST',
                mode: 'cors',
                headers: myHeaders,
                redirect: 'follow'
            };
            var list = [];
            fetch('https://qgccu4skxd.execute-api.ap-northeast-1.amazonaws.com/dev', requestOptions)
                .then(response => response.text())
                .then(result => {
                    list = JSON.parse(result).body;
                    var str = '';
                    for (var i in list) {
                        str = str + '<a class="dropdown-item" href="javascript:void(0);" onClick="addParam(\'' + paramKey + '\', \'' + list[i] + '\')">' + list[i] + '</a>';
                    }
                    str = str + '<a class="dropdown-item" href="javascript:void(0);" onClick="addParam(\'' + paramKey + '\', \'\')"></a>';
                    document.getElementById(targetId).innerHTML = str;
                })
                .catch(error => console.log('error', error));
            var selected = getParam(paramKey);
            if (selected == null || selected == '') {
                document.getElementById(paramKey).innerText = 'カテゴリ';
            }
            else {
                document.getElementById(paramKey).innerText = selected;
            }
        }

        var initPrefecture = () => {
            const paramKey = 'prefecture';
            const targetId = 'prefecture-list';
            const list = [
                '愛知県', '青森県', '秋田県', '石川県', '茨城県', '岩手県', '愛媛県',
                '大分県', '大阪府', '岡山県', '沖縄県', '香川県', '鹿児島県', '神奈川県',
                '岐阜県', '京都府', '熊本県', '群馬県', '高知県', '埼玉県', '佐賀県',
                '滋賀県', '静岡県', '島根県', '千葉県', '東京都', '徳島県', '栃木県',
                '鳥取県', '富山県', '長崎県', '長野県', '奈良県', '新潟県', '兵庫県',
                '広島県', '福井県', '福岡県', '福島県', '北海道', '三重県', '宮城県',
                '宮崎県', '山形県', '山口県', '山梨県', '和歌山県'
            ];
            var selected = getParam(paramKey);
            if (selected == null || selected == '') {
                document.getElementById(paramKey).innerText = '都道府県';
            }
            else {
                document.getElementById(paramKey).innerText = selected;
            }
            var str = '';
            for (var i in list) {
                str = str + '<a class="dropdown-item" href="javascript:void(0);" onClick="addParam(\'' + paramKey + '\',　\'' + list[i] + '\');">' + list[i] + '</a>';
            }
            str = str + '<a class="dropdown-item" href="javascript:void(0);" onClick="addParam(\'' + paramKey + '\', \'\')"></a>';
            document.getElementById(targetId).innerHTML = str;
        }

        var initRegion = () => {
            const paramKey = 'region';
            const targetId = 'region-list';
            // instantiate a headers object
            var myHeaders = new Headers();
            // add content type header to object
            myHeaders.append('Content-Type', 'application/json');
            // create a JSON object with parameters for API call and store in a variable
            var requestOptions = {
                method: 'POST',
                mode: 'cors',
                headers: myHeaders,
                redirect: 'follow'
            };
            var list = [];
            var url = new URL('https://5g9xgvjr3e.execute-api.ap-northeast-1.amazonaws.com/dev');
            url.searchParams.set('prefecture', getParam('prefecture'));
            url.searchParams.set('category', getParam('category'));
            fetch(url.toString(), requestOptions)
                .then(response => response.text())
                .then(result => {
                    list = JSON.parse(result).body;
                    var str = '';
                    for (var i in list) {
                        str = str + '<a class="dropdown-item" href="javascript:void(0);" onClick="addParam(\'' + paramKey + '\', \'' + list[i] + '\')">' + list[i] + '</a>';
                    }
                    str = str + '<a class="dropdown-item" href="javascript:void(0);" onClick="addParam(\'' + paramKey + '\', \'\')"></a>';
                    document.getElementById(targetId).innerHTML = str;
                })
                .catch(error => console.log('error', error));
            var selected = getParam(paramKey);
            if (selected == null || selected == '') {
                document.getElementById(paramKey).innerText = '地域';
            }
            else {
                document.getElementById(paramKey).innerText = selected;
            }
        }

        var initShop = () => {
            const paramKey = 'shop';
            const targetId = 'shop-list';
            // instantiate a headers object
            var myHeaders = new Headers();
            // add content type header to object
            myHeaders.append('Content-Type', 'application/json');
            // create a JSON object with parameters for API call and store in a variable
            var requestOptions = {
                method: 'POST',
                mode: 'cors',
                headers: myHeaders,
                redirect: 'follow'
            };
            var list = [];
            var url = new URL('https://ok6ztcirbe.execute-api.ap-northeast-1.amazonaws.com/dev');
            url.searchParams.set('prefecture', getParam('prefecture'));
            url.searchParams.set('category', getParam('category'));
            url.searchParams.set('region', getParam('region'));
            fetch(url.toString(), requestOptions)
                .then(response => response.text())
                .then(result => {
                    list = JSON.parse(result).body;
                    var str = '';
                    for (var i in list) {
                        str = str + '<a class="dropdown-item" href="javascript:void(0);" onClick="addParam(\'' + paramKey + '\', \'' + list[i] + '\')">' + list[i] + '</a>';
                    }
                    str = str + '<a class="dropdown-item" href="javascript:void(0);" onClick="addParam(\'' + paramKey + '\', \'\')"></a>';
                    document.getElementById(targetId).innerHTML = str;
                })
                .catch(error => console.log('error', error));
            var selected = getParam(paramKey);
            if (selected == null || selected == '') {
                document.getElementById(paramKey).innerText = '店名';
            }
            else {
                document.getElementById(paramKey).innerText = selected;
            }
        }

        // define the callAPI function that takes a first name and last name as parameters
        var callAPI = (firstName, lastName) => {
            // instantiate a headers object
            var myHeaders = new Headers();
            // add content type header to object
            myHeaders.append('Content-Type', 'application/json');
            // create a JSON object with parameters for API call and store in a variable
            var requestOptions = {
                method: 'POST',
                mode: 'cors',
                headers: myHeaders,
                redirect: 'follow'
            };
            // make API call with parameters and use promises to get response
            fetch('https://vtf16tonga.execute-api.ap-northeast-1.amazonaws.com/dev', requestOptions)
                .then(response => response.text())
                .then(result => alert(JSON.parse(result).body))
                .catch(error => console.log('error', error));
        }

        function addParam(key, value) {
            var url = new URL(location);
            if (key == 'prefecture' || key == 'category') {
                document.getElementById('region').innerText = '地域';
                url.searchParams.delete('region');
                document.getElementById('shop').innerText = '店名';
                url.searchParams.delete('shop');
            }
            if (value == null || value == '') {
                url.searchParams.delete(key);
            }
            else {
                url.searchParams.set(key, value);
            }
            location.href = url;
        }

        /**
         * Get the URL parameter value
         *
         * @param  name {string} パラメータのキー文字列
         * @return  url {url} 対象のURL文字列（任意）
         */
        function getParam(name, url) {
            if (!url) url = window.location.href;
            name = name.replace(/[\[\]]/g, "\\$&");
            var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, " "));
        }
    </script>
    <title>出勤履歴検索</title>
</head>

<body>
    <ul class="nav nav-tabs">
        <li class="nav-item">
            <a href="#select-pane" class="nav-link active" data-toggle="tab">店名から検索</a>
        </li>
        <li class="nav-item">
            <a href="#direct-pane" class="nav-link" data-toggle="tab">直接入力して検索</a>
        </li>
    </ul>
    <div class="tab-content">
        <div id="select-pane" class="tab-pane active">
            <div class="dropdown mx-3 my-1">
                <a class="btn btn-secondary dropdown-toggle" href="#" role="button" id="category" data-toggle="dropdown"
                    aria-haspopup="true" aria-expanded="false">
                    カテゴリ
                </a>
                <div class="dropdown-menu" aria-labelledby="category" id="category-list"></div>
            </div>
            <div class="dropdown mx-3 my-1">
                <a class="btn btn-secondary dropdown-toggle" href="#" role="button" id="prefecture"
                    data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    都道府県
                </a>
                <div class="dropdown-menu" aria-labelledby="prefecture" id="prefecture-list"></div>
            </div>
            <div class="dropdown mx-3 my-1">
                <a class="btn btn-secondary dropdown-toggle" href="#" role="button" id="region" data-toggle="dropdown"
                    aria-haspopup="true" aria-expanded="false">
                    地域
                </a>
                <div class="dropdown-menu" aria-labelledby="region" id="region-list"></div>
            </div>
            <div class="dropdown mx-3 my-1">
                <a class="btn btn-secondary dropdown-toggle" href="#" role="button" id="shop" data-toggle="dropdown"
                    aria-haspopup="true" aria-expanded="false">
                    店名
                </a>
                <div class="dropdown-menu" aria-labelledby="shop" id="shop-list"></div>
            </div>
        </div>
        <div id="direct-pane" class="tab-pane">
            <form class="mx-3">
                <div class="form-group">
                    <!-- <label for="exampleInputEmail1">Email address</label> -->
                    <input type="email" class="form-control mt-3" id="fName" placeholder="検索キーワード">
                    <!-- <small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone else.</small> -->
                </div>
                <button type="submit" class="btn btn-primary" onclick="callAPI()">検索</button>
            </form>
        </div>
        <div class="mx-5 mt-5">
            <table class="table table-borderless">
                <tbody>
                    <tr>
                        <td colspan="5">
                            <input class="form-check-input ms-8" type="checkbox" value=""
                                aria-label="check-cast">すべてのキャスト
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input class="form-check-input" type="checkbox" value="" aria-label="check-cast">
                            First checkbox
                        </td>
                        <td>
                            <input class="form-check-input" type="checkbox" value="" aria-label="check-cast">
                            Second checkbox
                        </td>
                        <td>
                            <input class="form-check-input" type="checkbox" value="" aria-label="check-cast">
                            Third checkbox
                        </td>
                        <td>
                            <input class="form-check-input" type="checkbox" value="" aria-label="check-cast">
                            Fourth checkbox
                        </td>
                        <td>
                            <input class="form-check-input" type="checkbox" value="" aria-label="check-cast">
                            Fifth checkbox
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input class="form-check-input" type="checkbox" value="" aria-label="check-cast">
                            Sixth checkbox
                        </td>
                        <td>
                            <input class="form-check-input" type="checkbox" value="" aria-label="check-cast">
                            Seventh checkbox
                        </td>
                        <td>
                            <input class="form-check-input" type="checkbox" value="" aria-label="check-cast">
                            Eighth checkbox
                        </td>
                        <td>
                            <input class="form-check-input" type="checkbox" value="" aria-label="check-cast">
                            Ninth checkbox
                        </td>
                        <td>
                            <input class="form-check-input" type="checkbox" value="" aria-label="check-cast">
                            Tenth checkbox
                        </td>
                    </tr>
                </tbody>
            </table>
            <ul class="list-group list-group-flush mt-3">
                <li class="list-group-item">
                    <input class="form-check-input me-1" type="radio" value="" aria-label="radio-term">先日
                </li>
                <li class="list-group-item">
                    <input class="form-check-input me-1" type="radio" value="" aria-label="radio-term">1週間
                </li>
                <li class="list-group-item">
                    <input class="form-check-input me-1" type="radio" value="" aria-label="radio-term">2週間
                </li>
                <li class="list-group-item">
                    <input class="form-check-input me-1" type="radio" value="" aria-label="radio-term">1ヶ月
                </li>
            </ul>
            <div class="input-group">
                <span class="input-group-text" id="inputGroup-sizing-default">
                    <input class="form-check-input" type="radio" value="" aria-label="radio-term">
                </span>
                <input type="text" class="form-control" aria-label="Text input with radio button">
            </div>
        </div>
    </div>


    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"
        integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
        crossorigin="anonymous"></script>
</body>

</html>